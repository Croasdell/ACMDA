"""
Indexes the services.txt file and prints each section as a list.
Includes error handling, basic logging, and user prompts.
"""

import os
import datetime

LOG_FILE = "index_services.log"

def log_error(message):
    timestamp = datetime.datetime.now().isoformat()
    with open(LOG_FILE, "a") as log:
        log.write(f"[{timestamp}] ERROR: {message}\n")

def index_services(filename="services.txt"):
    if not os.path.exists(filename):
        print(f"Error: '{filename}' not found in the current directory.")
        log_error(f"File not found: {filename}")
        user_input = input("Would you like to specify a different file? (y/n): ").strip().lower()
        if user_input == "y":
            filename = input("Enter the path to the services file: ").strip()
            if not os.path.exists(filename):
                print(f"Error: '{filename}' still not found. Exiting.")
                log_error(f"User-specified file not found: {filename}")
                return
        else:
            print("Exiting script.")
            return

    try:
        with open(filename, "r") as f:
            lines = f.readlines()
    except Exception as e:
        print(f"An unexpected error occurred: {e}")
        log_error(f"Unexpected error: {e}")
        return

    print("Indexed Services and Policies:")
    section = None
    for line in lines:
        line = line.strip()
        if not line:
            continue
        if line.endswith(":"):
            section = line
            print(f"\n{section}")
        elif line.startswith("-"):
            print(f"  {line}")
        else:
            print(line)

if __name__ == "__main__":
    index_services()